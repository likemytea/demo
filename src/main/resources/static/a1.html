<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>a1</title>
<style type = "text/css">
#msg{
	display:none;
	position:absolute;
	background:gray;
	width:200px;
	height:300px;
	overflow:auto;
	scrollbar-base-color: #E8CCFF;
    scrollbar-track-color: #CCCCFF;

}
.bg{
    background-color: gray;
}
.bg:hover{
    background-color: burlywood;
}
</style>

<script type="text/javascript" src="js/jquery-1.js"></script>
<script type="text/javascript">
function setDivHidden()
{
	 var addr=document.getElementById("msg")
	 addr.style.display = "none"; 
}
function showDiv(o)
{
	 var point=new Object();
	 point.x=o.offsetLeft;
	 point.y=o.offsetTop+o.offsetHeight;
	 while(o=o.offsetParent)
	 {
	  point.x+=o.offsetLeft;
	  point.y+=o.offsetTop;
	 }
	 var addr=document.getElementById("msg")
	 addr.style.left=point.x+"px";
	 addr.style.top=point.y+"px";
	 addr.style.display = "block";
	 flushCombo(true);
}

function updateLi(thekey,theval){
	var ele = document.createElement('li');
	ele.innerHTML='<li id="'+thekey+'" class="bg">'+theval+'</li>';
	document.getElementById('msgul').appendChild(ele);
}

//鼠标键入事件
function flushCombo(isOnfocusEvent){
	var input = document.getElementById('myinput').value;
	if(input=='' && (!isOnfocusEvent)){
		return;
	}
	var reg =  new RegExp(input);
	//获取原始数据
	var original = getOriginalData();
	//解析为数组
	var dataArray = JSON.parse(original);
	
	//清空层里边所有的li
	$("#msgul").find("li").remove();
	
	//遍历数组
	for (var i = 0, l = dataArray.length; i < l; i++) {
		var theval='';
		var thekey='';
	    for (var key in dataArray[i]) {
	    	//找到某一条里边的name
	    	if(key=='name'){
	    		//确定这个name是否满足搜索条件
	    		if(reg.test(dataArray[i][key])||isOnfocusEvent){
	    			theval = dataArray[i][key];
	    		}else{
		    		continue;
		    	}
	    		
	    	}
	    	//设置name对应的业务key
	    	if(key=='strVal'){
	    		thekey=dataArray[i][key];
	    	}
	    	//过滤掉没用的数据，因为执行到这里的还可能是数组中name前的key-value
	    	if(theval.length>0&&thekey.length>0){
	    		updateLi(thekey,theval);
	    	}
	    }
	}
}


function getOriginalData(){
	var a = '[{\"name\":\"全部\",\"selected\":\"true\"},{\"id\":\"1\",\"name\":\"核心企业\",\"selected\":\"false\",\"strVal\":\"01\"},{\"id\":\"2\",\"name\":\"借款1111企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款222222企业\",\"selected\":\"false\",\"strVal\":\"03\"},{\"id\":\"2\",\"name\":\"借款3333333企业\",\"selected\":\"false\",\"strVal\":\"04\"},{\"id\":\"2\",\"name\":\"借款444444444444企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借3232222款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"1211借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业323444\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款企业\",\"selected\":\"false\",\"strVal\":\"02\"},{\"id\":\"2\",\"name\":\"借款777企9999999999999999999999999999999999999999业\",\"selected\":\"false\",\"strVal\":\"0072\"}]';
	return a;
}

$(document).ready(function() {
	//li点击事件
    $(document).on("click", "li.bg", function() {
    	//赋值隐藏域，用于传给后台
        document.getElementById("myinputChoice").value = $(this).attr('id');
        //赋值给text文本框
        document.getElementById("myinput").value = $(this).text();
        //隐藏下拉框
        setDivHidden();
    });
});
function testRes(){
	alert(document.getElementById("myinputChoice").value);
}
</script>
</head>
<body>
--------------------------------------------------
<input type ="text" id ="myinput" oninput="flushCombo(false)" style="width:197px; height:20px;" placeholder="请输入关键词" onfocus="showDiv(this)"/>
<input type="hidden" id="myinputChoice" value=""/>
<input type = "button" name ="button" onClick="testRes();" value="测试结果">
<div id="msg">
	<ul id="msgul" style="list-style-type:none;padding:5px;margin:0;">
	</ul>
</div>
</body>
</html>